<!-- public/profile.html -->
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>User Profile</title>
    <link rel="stylesheet" type="text/css" href="profile.css">

    <main>
        <div id="pokemonDisplay" class="pokemon-container"></div> <!-- Container for displaying Pokémon cards -->
        <ul id="pokemon-list"></ul> <!-- List to display fetched Pokémon -->
    </main>    

    <style>
        @media only screen and (max-width: 600px) {
            nav {
                width: 100%;
                /* Adjust as needed */
                max-width: 500px;
                /* Set a maximum width for the sidebar */
            }

            main {
                margin-left: 0;
                /* Reset margin for main content */
            }
        }
    </style>

    <script>
        function logout() {
            fetch('/logout', { method: 'GET' })
                .then(response => {
                    if (response.ok) {
                        window.location.href = '/signin'; // Redirect to sign-in after logout
                    }
                });
        }

        function getPokemon() {
            fetch('/pokemon') // Calls the endpoint to get Pokémon data
                .then(response => response.json())
                .then(data => {
                    const pokemonList = document.getElementById('pokemon-list');
                    pokemonList.innerHTML = ''; // Clear any existing content

                    // Display Pokémon data
                    data.results.forEach(pokemon => {
                        const listItem = document.createElement('li');
                        listItem.textContent = pokemon.name;
                        pokemonList.appendChild(listItem);
                    });
                });
        }
    </script>
</head>

<body>
    <header>
        <h1>Welcome to Your Profile</h1>
        <button onclick="logout()">Log Out</button> <!-- Logout button -->
        <button onclick="getPokemon()">Get Pokémon</button> <!-- Button to fetch Pokémon data -->
    </header>

    <nav>
        <ul>
            <li><a href="/pokedex" id="pokedexLink">Pokédex</a></li>
            <li><a href="/dailycatch" id="dailyCatchLink">Daily Catch</a></li>
            <li><a href="/profile" id="profileLink">My Team</a></li>
            <li><a href="/settings" id="settingsLink">Settings</a></li>
            <li><a href="/logout" id="logOutLink">Log Out</a></li>
            <!-- Add more navigation links as needed -->
        </ul>
    </nav>

    <main>
        <ul id="pokemon-list"></ul> <!-- List to display fetched Pokémon -->
    </main>

    <footer>
        <!-- Footer content -->
    </footer>
</body>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        fetch('/my-team') // Calls the endpoint to get the user's Pokémon team
            .then(response => response.json())
            .then(team => {
                if (team && Object.values(team).length) {
                    displayTeam(team);
                } else {
                    console.log('No Pokémon team found or team is empty.');
                }
            })
            .catch(error => console.error('Failed to load Pokémon team:', error));
    });

    async function displayTeam(team) {
        const pokemonDisplay = document.getElementById("pokemonDisplay");
        pokemonDisplay.innerHTML = ""; // Clear previous content

        // Iterate through each Pokémon ID in the team and fetch their details
        for (const key in team) {
            const pokemonId = team[key];
            if (pokemonId) { // Ensure there's a valid ID
                try {
                    const response = await fetch(`/pokemon/${pokemonId}`);
                    if (!response.ok) {
                        throw new Error(`Failed to fetch Pokémon with ID ${pokemonId}`);
                    }
                    const pokemon = await response.json();

                    const capitalizedPokemonName = pokemon.name.charAt(0).toUpperCase() + pokemon.name.slice(1);
                    const types = pokemon.types.map(type => type.type.name.charAt(0).toUpperCase() + type.type.name.slice(1)).join(", ");
                    const stats = pokemon.stats.map(stat => `${stat.stat.name.charAt(0).toUpperCase() + stat.stat.name.slice(1)}: ${stat.base_stat}`).join(", ");
                    const moves = pokemon.moves.map(move => move.move.name.charAt(0).toUpperCase() + move.move.name.slice(1)).slice(0, 5).join(", "); // Display first 5 moves

                    const pokemonCard = document.createElement("div");
                    pokemonCard.classList.add("pokemon-card");
                    pokemonCard.innerHTML = `
                        <h2>${capitalizedPokemonName}</h2>
                        <img src="${pokemon.sprites.front_default}" alt="${pokemon.name}">
                        <p>Types: ${types}</p>
                        <p>Stats: ${stats}</p>
                        <p>Top Moves: ${moves}</p>
                    `;

                    pokemonDisplay.appendChild(pokemonCard);
                } catch (error) {
                    console.error(`Error fetching Pokémon with ID ${pokemonId}:`, error);
                    pokemonDisplay.innerHTML += `<p>Failed to fetch Pokémon with ID ${pokemonId}. Please try again.</p>`;
                }
            }
        }
    }
</script>

</html>